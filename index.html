<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Forgotten Town</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
html,body{
  margin:0;
  padding:0;
  background:#222;
  overflow:hidden;
  touch-action:none;
}
canvas{display:block;}

#ui{
  position:fixed;
  top:10px;
  left:10px;
  color:white;
  font-size:18px;
  z-index:50;
}

#actionBtn{
  position:fixed;
  bottom:140px;
  right:20px;
  padding:12px 18px;
  font-size:18px;
  display:none;
  z-index:30;
}
</style>
</head>
<body>

<div id="ui">
Inventario:<br>
ðŸªµ Madera: <span id="woodCount">0</span><br>
ðŸª“ Hacha: <span id="axeState">No</span>
</div>

<canvas id="game"></canvas>
<button id="actionBtn">AcciÃ³n</button>

<script>

/* ===== CANVAS ===== */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

function resize(){
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;
}
window.addEventListener("resize",resize);
resize();

/* ===== CONFIG ===== */
const SIZE=128;
const SPEED=4;
const WORLD_W=3000;
const WORLD_H=3000;

/* ===== ZOOM ===== */
let zoom=1;
canvas.addEventListener("wheel",e=>{
  e.preventDefault();
  zoom+=e.deltaY*-0.001;
  zoom=Math.max(0.5,Math.min(2,zoom));
});

/* ===== CÃMARA ===== */
let camera={x:0,y:0};

/* ===== INVENTARIO ===== */
let inventory={wood:0,axe:false};
const axeUI=document.getElementById("axeState");

/* ===== JUGADOR ===== */
let pony={
  x:WORLD_W/2,
  y:WORLD_H/2,
  facing:"right"
};

/* ===== NPC ===== */
function createNPC(x,y){
  return {x,y,dead:false};
}
let npcs=[
  createNPC(pony.x+200,pony.y-100),
  createNPC(pony.x-200,pony.y+100)
];

/* ===== HACHA ===== */
let axeWorld={
  x:pony.x+120,
  y:pony.y+60,
  picked:false
};

/* ===== EVENTO SIMPLE ===== */
let creepyActive=false;
let creepyTimer=0;

/* ===== BOTÃ“N ===== */
let actionType=null;
let targetNPC=null;
const actionBtn=document.getElementById("actionBtn");

actionBtn.onclick=()=>{
  if(actionType==="pick"){
    inventory.axe=true;
    axeWorld.picked=true;
    axeUI.innerText="SÃ­";
  }

  if(actionType==="kill" && targetNPC){
    targetNPC.dead=true;
    creepyActive=true;
    creepyTimer=180; // 3 segundos
  }
};

/* ===== CONTROLES TECLADO (para test rÃ¡pido) ===== */
let keys={};
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

/* ===== UPDATE ===== */
function update(){

  if(!creepyActive){
    if(keys["ArrowRight"]){ pony.x+=SPEED; pony.facing="right"; }
    if(keys["ArrowLeft"]){ pony.x-=SPEED; pony.facing="left"; }
    if(keys["ArrowUp"]){ pony.y-=SPEED; }
    if(keys["ArrowDown"]){ pony.y+=SPEED; }
  }

  pony.x=Math.max(0,Math.min(WORLD_W-SIZE,pony.x));
  pony.y=Math.max(0,Math.min(WORLD_H-SIZE,pony.y));

  camera.x=pony.x-(canvas.width/(2*zoom))+SIZE/2;
  camera.y=pony.y-(canvas.height/(2*zoom))+SIZE/2;

  /* PROXIMIDAD */
  actionType=null;
  targetNPC=null;

  if(!inventory.axe && !axeWorld.picked){
    if(Math.hypot(pony.x-axeWorld.x,pony.y-axeWorld.y)<120){
      actionType="pick";
    }
  }

  if(inventory.axe){
    npcs.forEach(n=>{
      if(!n.dead){
        if(Math.hypot(pony.x-n.x,pony.y-n.y)<150){
          actionType="kill";
          targetNPC=n;
        }
      }
    });
  }

  actionBtn.style.display=actionType?"block":"none";
  actionBtn.innerText=
    actionType==="pick"?"Recoger":
    actionType==="kill"?"KILL...":"";

  if(actionType==="kill"){
    actionBtn.style.background="#8b0000";
    actionBtn.style.color="white";
  }else{
    actionBtn.style.background="";
  }

  if(creepyActive){
    creepyTimer--;
    if(creepyTimer<=0){
      creepyActive=false;
    }
  }

  draw();
  requestAnimationFrame(update);
}

/* ===== DRAW ===== */
function draw(){
  ctx.setTransform(zoom,0,0,zoom,0,0);
  ctx.clearRect(0,0,canvas.width/zoom,canvas.height/zoom);

  ctx.fillStyle="#4caf50";
  ctx.fillRect(0-camera.x,0-camera.y,WORLD_W,WORLD_H);

  /* NPC */
  npcs.forEach(n=>{
    if(n.dead) return;
    ctx.fillStyle="purple";
    ctx.fillRect(n.x-camera.x,n.y-camera.y,50,50);
  });

  /* JUGADOR */
  ctx.fillStyle="red";
  ctx.fillRect(pony.x-camera.x,pony.y-camera.y,50,50);

  /* HACHA SUELO */
  if(!axeWorld.picked){
    ctx.fillStyle="#c62828";
    ctx.fillRect(axeWorld.x-camera.x,axeWorld.y-camera.y,40,20);
  }

  ctx.setTransform(1,0,0,1,0,0);

  /* OSCURECER */
  if(creepyActive){
    ctx.fillStyle="rgba(0,0,0,0.6)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle="red";
    ctx.font="40px Arial";
    ctx.textAlign="center";
    ctx.fillText(
      "- Â¿Por quÃ© lo hiciste Eva...? -",
      canvas.width/2,
      canvas.height/2
    );
  }
}

update();
</script>
</body>
</html>
