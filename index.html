<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Forgotten Town</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: #2b2b2b;
  color: white;
  font-family: Arial, sans-serif;
  text-align: center;
}

canvas {
  background: #3a3a3a;
  margin: 10px auto;
  display: block;
  border-radius: 8px;
}

.controls {
  position: fixed;
  bottom: 12px;
  left: 0;
  right: 0;
  text-align: center;
}

.controls button {
  width: 60px;
  height: 60px;
  font-size: 22px;
  margin: 4px;
  border-radius: 8px;
  border: none;
  background-color: #8a5ccf;
  color: white;
}
</style>
</head>

<body>
<h1>游냢 Forgotten Town</h1>
<p>Servidor personalizado inspirado en Pony Town</p>

<canvas id="game" width="800" height="500"></canvas>

<div class="controls">
  <button ontouchstart="press('up')" ontouchend="release('up')">拘勇</button><br>
  <button ontouchstart="press('left')" ontouchend="release('left')">拘勇</button>
  <button ontouchstart="press('right')" ontouchend="release('right')">俱뫮잺</button><br>
  <button ontouchstart="press('down')" ontouchend="release('down')">拘勇</button>
</div>

<script>
/* ===== CANVAS ===== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ===== PONY ===== */
let pony = {
  x: canvas.width / 2 - 64,
  y: canvas.height / 2 - 64,
  speed: 3
};

let keys = { up:false, down:false, left:false, right:false };
let facing = "right";

/* ===== SPRITESHEET ===== */
const ponyImg = new Image();
ponyImg.src = "pony_walk.png";

/* CONFIGURACI칍N DEL SPRITE */
const FRAME_COUNT = 15;      // tus 15 fotogramas
const FRAME_WIDTH = 64;      // ajustable si quer칠s
const FRAME_HEIGHT = 64;
const SCALE = 2;             // tama침o en pantalla

let frame = 0;
let frameTimer = 0;
const FRAME_DELAY = 6;       // menor = m치s r치pido

ponyImg.onload = () => {
  requestAnimationFrame(update);
};

/* ===== DIBUJO ===== */
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.save();

  if (facing === "left") {
    ctx.translate(pony.x + FRAME_WIDTH * SCALE, pony.y);
    ctx.scale(-1, 1);
  } else {
    ctx.translate(pony.x, pony.y);
  }

  ctx.drawImage(
    ponyImg,
    frame * FRAME_WIDTH, 0,               // recorte
    FRAME_WIDTH, FRAME_HEIGHT,
    0, 0,
    FRAME_WIDTH * SCALE, FRAME_HEIGHT * SCALE
  );

  ctx.restore();
}

/* ===== UPDATE ===== */
function update() {
  let moving = false;

  if (keys.up)    { pony.y -= pony.speed; moving = true; }
  if (keys.down)  { pony.y += pony.speed; moving = true; }
  if (keys.left)  { pony.x -= pony.speed; facing = "left";  moving = true; }
  if (keys.right) { pony.x += pony.speed; facing = "right"; moving = true; }

  // l칤mites
  pony.x = Math.max(0, Math.min(canvas.width - FRAME_WIDTH * SCALE, pony.x));
  pony.y = Math.max(0, Math.min(canvas.height - FRAME_HEIGHT * SCALE, pony.y));

  // animaci칩n SOLO si se mueve
  if (moving) {
    frameTimer++;
    if (frameTimer >= FRAME_DELAY) {
      frame = (frame + 1) % FRAME_COUNT;
      frameTimer = 0;
    }
  } else {
    frame = 0; // frame quieto
  }

  draw();
  requestAnimationFrame(update);
}

/* ===== CONTROLES ===== */
function press(dir) { keys[dir] = true; }
function release(dir) { keys[dir] = false; }

document.addEventListener("keydown", e => {
  if (e.key === "ArrowUp") press("up");
  if (e.key === "ArrowDown") press("down");
  if (e.key === "ArrowLeft") press("left");
  if (e.key === "ArrowRight") press("right");
});

document.addEventListener("keyup", e => {
  if (e.key === "ArrowUp") release("up");
  if (e.key === "ArrowDown") release("down");
  if (e.key === "ArrowLeft") release("left");
  if (e.key === "ArrowRight") release("right");
});
</script>
</body>
</html>
